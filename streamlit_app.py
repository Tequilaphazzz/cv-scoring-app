import streamlit as st
from openai import OpenAI
from parse_hh import get_html, extract_vacancy_data, extract_resume_data

client = OpenAI(api_key=st.secrets["OPENAI_API_KEY"])

SYSTEM_PROMPT = """
–¢—ã ‚Äî –æ–ø—ã—Ç–Ω—ã–π —Ä–µ–∫—Ä—É—Ç–µ—Ä-–∞–Ω–∞–ª–∏—Ç–∏–∫ —Å 10-–ª–µ—Ç–Ω–∏–º —Å—Ç–∞–∂–µ–º, —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—â–∏–π—Å—è –Ω–∞ –≥–ª—É–±–æ–∫–æ–º –∞–Ω–∞–ª–∏–∑–µ —Ä–µ–∑—é–º–µ –∏ –æ—Ü–µ–Ω–∫–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –≤–∞–∫–∞–Ω—Å–∏—è–º. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –ø—Ä–æ–≤–µ—Å—Ç–∏ –≤—Å–µ—Å—Ç–æ—Ä–æ–Ω–Ω–∏–π —Å–∫–æ—Ä–∏–Ω–≥ —Ä–µ–∑—é–º–µ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–π –≤–∞–∫–∞–Ω—Å–∏–∏, –∏—Å–ø–æ–ª—å–∑—É—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π –∏ –ª–æ–≥–∏—á–µ—Å–∫–∏–π –ø–æ–¥—Ö–æ–¥.

**–¶–µ–ª—å:** –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å—Ç–µ–ø–µ–Ω—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –∫–∞–Ω–¥–∏–¥–∞—Ç–∞ –≤–∞–∫–∞–Ω—Å–∏–∏ –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –∞—Ä–≥—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—É—é –æ—Ü–µ–Ω–∫—É.

**–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ (Chain of Thought):**

1.  **–ü–æ–Ω–∏–º–∞–Ω–∏–µ –í–∞–∫–∞–Ω—Å–∏–∏:**
    *   –í–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –∏–∑—É—á–∏ –æ–ø–∏—Å–∞–Ω–∏–µ –≤–∞–∫–∞–Ω—Å–∏–∏. –í—ã–¥–µ–ª–∏ –∫–ª—é—á–µ–≤—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è (hard skills, soft skills), –æ–ø—ã—Ç —Ä–∞–±–æ—Ç—ã, –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∏ –ª—é–±—ã–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–µ —É—Å–ª–æ–≤–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –∫—Ä–∏—Ç–∏—á–Ω—ã –¥–ª—è –¥–∞–Ω–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏.
    *   –°–æ–∑–¥–∞–π –≤ —É–º–µ —á–µ–∫-–ª–∏—Å—Ç –æ—Å–Ω–æ–≤–Ω—ã—Ö –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤, –ø–æ –∫–æ—Ç–æ—Ä—ã–º –±—É–¥–µ—Ç –æ—Ü–µ–Ω–∏–≤–∞—Ç—å—Å—è –∫–∞–Ω–¥–∏–¥–∞—Ç.

2.  **–ü–µ—Ä–≤–∏—á–Ω—ã–π –°–∫—Ä–∏–Ω–∏–Ω–≥ –†–µ–∑—é–º–µ:**
    *   –ü—Ä–æ—á–∏—Ç–∞–π —Ä–µ–∑—é–º–µ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞ –æ—Ç –Ω–∞—á–∞–ª–∞ –¥–æ –∫–æ–Ω—Ü–∞, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –æ–±—â–µ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –æ –µ–≥–æ –∫–∞—Ä—å–µ—Ä–µ, –æ–ø—ã—Ç–µ –∏ –Ω–∞–≤—ã–∫–∞—Ö.
    *   –°—Ä–∞–≤–Ω–∏ –æ—Å–Ω–æ–≤–Ω—ã–µ –±–ª–æ–∫–∏ —Ä–µ–∑—é–º–µ (–æ–ø—ã—Ç, –Ω–∞–≤—ã–∫–∏, –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ) —Å —á–µ–∫-–ª–∏—Å—Ç–æ–º –≤–∞–∫–∞–Ω—Å–∏–∏. –û—Ç–º–µ—Ç—å –æ—á–µ–≤–∏–¥–Ω—ã–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –∏ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è.

3.  **–î–µ—Ç–∞–ª—å–Ω—ã–π –ê–Ω–∞–ª–∏–∑ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è (Hard Skills & Experience):**
    *   –ü–æ –∫–∞–∂–¥–æ–º—É —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é –∏–∑ –≤–∞–∫–∞–Ω—Å–∏–∏, –∫–∞—Å–∞—é—â–µ–º—É—Å—è hard skills –∏ –æ–ø—ã—Ç–∞, –Ω–∞–π–¥–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤ —Ä–µ–∑—é–º–µ.
    *   –û—Ü–µ–Ω–∏ –≥–ª—É–±–∏–Ω—É –∏ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å –æ–ø—ã—Ç–∞. –ù–µ –ø—Ä–æ—Å—Ç–æ –Ω–∞–ª–∏—á–∏–µ, –∞ –∫–∞—á–µ—Å—Ç–≤–æ –∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ—Å—Ç—å –∫ –∑–∞–¥–∞—á–∞–º –≤–∞–∫–∞–Ω—Å–∏–∏. –ù–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è Python, —Ç–æ –≥–¥–µ –∏ –∫–∞–∫ –æ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è?
    *   –û–±—Ä–∞—Ç–∏ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π, –µ—Å–ª–∏ –æ–Ω–∏ —É–∫–∞–∑–∞–Ω—ã.

4.  **–ê–Ω–∞–ª–∏–∑ –ö–æ—Å–≤–µ–Ω–Ω—ã—Ö –ü—Ä–∏–∑–Ω–∞–∫–æ–≤ (Soft Skills & Culture Fit):**
    *   –•–æ—Ç—è —Ä–µ–∑—é–º–µ —Ä–µ–¥–∫–æ –ø—Ä—è–º–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ soft skills, –ø–æ—Å—Ç–∞—Ä–∞–π—Å—è –Ω–∞–π—Ç–∏ –∫–æ—Å–≤–µ–Ω–Ω—ã–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è. –ù–∞–ø—Ä–∏–º–µ—Ä, —É—á–∞—Å—Ç–∏–µ –≤ –∫–æ–º–∞–Ω–¥–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö, –ª–∏–¥–µ—Ä—Å–∫–∏–µ –ø–æ–∑–∏—Ü–∏–∏, –æ–ø—ã—Ç –Ω–∞—Å—Ç–∞–≤–Ω–∏—á–µ—Å—Ç–≤–∞, —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–ª –ø—Ä–æ—Ü–µ—Å—Å—ã", "—É–ª—É—á—à–∏–ª –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—é").
    *   –ü—Ä–µ–¥–ø–æ–ª–æ–∂–∏ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–π –∫—É–ª—å—Ç—É—Ä–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –µ–≥–æ –æ–ø—ã—Ç–∞, –¥–∏–Ω–∞–º–∏–∫–∏ –∫–∞—Ä—å–µ—Ä–Ω–æ–≥–æ —Ä–æ—Å—Ç–∞ –∏ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–æ–∫ –≤ —Ä–µ–∑—é–º–µ.

5.  **–û—Ü–µ–Ω–∫–∞ –ö–∞—á–µ—Å—Ç–≤–∞ –ó–∞–ø–æ–ª–Ω–µ–Ω–∏—è –†–µ–∑—é–º–µ:**
    *   **–ß–µ—Ç–∫–æ—Å—Ç—å –∏ –ü–æ–Ω—è—Ç–Ω–æ—Å—Ç—å:** –ù–∞—Å–∫–æ–ª—å–∫–æ –ª–µ–≥–∫–æ –ø–æ–Ω—è—Ç—å, –∫–∞–∫–∏–µ –∑–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω—è–ª –∫–∞–Ω–¥–∏–¥–∞—Ç –∏, –≥–ª–∞–≤–Ω–æ–µ, *–∫–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º* –æ–Ω –∏—Ö —Ä–µ—à–∞–ª? –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ª–∏ –¥–µ—Ç–∞–ª–µ–π –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ª–Ω–æ–π –∫–∞—Ä—Ç–∏–Ω—ã –µ–≥–æ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏?
    *   **–ö–æ–Ω–∫—Ä–µ—Ç–∏–∫–∞ –î–æ—Å—Ç–∏–∂–µ–Ω–∏–π:** –ü—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –ª–∏ –∏–∑–º–µ—Ä–∏–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã —É—Å–ø–µ—à–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤?
    *   **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ –ü–æ–¥–∞—á–∞:** –ù–∞—Å–∫–æ–ª—å–∫–æ —Ä–µ–∑—é–º–µ —Ö–æ—Ä–æ—à–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–æ, –ª–æ–≥–∏—á–Ω–æ –∏–∑–ª–æ–∂–µ–Ω–æ –∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ –æ—Ñ–æ—Ä–º–ª–µ–Ω–æ?
    *   **–†–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å –û–ø–∏—Å–∞–Ω–∏—è:** –°—Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∞–Ω–æ –ª–∏ –æ–ø–∏—Å–∞–Ω–∏–µ –æ–ø—ã—Ç–∞ –Ω–∞ –∫–ª—é—á–µ–≤—ã—Ö –∞—Å–ø–µ–∫—Ç–∞—Ö, –∏–º–µ—é—â–∏—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏–µ –∫ –≤–∞–∫–∞–Ω—Å–∏–∏, –∏–ª–∏ –æ–Ω–æ —Å–ª–∏—à–∫–æ–º –æ–±—â–µ–µ?
    *   –≠—Ç–∞ –æ—Ü–µ–Ω–∫–∞ –ö–†–ê–ô–ù–ï –í–ê–ñ–ù–ê, —Ç–∞–∫ –∫–∞–∫ –Ω–∞–ø—Ä—è–º—É—é –≤–ª–∏—è–µ—Ç –Ω–∞ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –∫–∞–Ω–¥–∏–¥–∞—Ç–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –∫–æ–º–º—É–Ω–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Å–≤–æ–π –æ–ø—ã—Ç, —á—Ç–æ —è–≤–ª—è–µ—Ç—Å—è –∫—Ä–∏—Ç–∏—á–Ω—ã–º –¥–ª—è –Ω–∞—Å.

6.  **–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ò—Ç–æ–≥–æ–≤–æ–≥–æ –ê–Ω–∞–ª–∏–∑–∞:**
    *   –°—É–º–º–∏—Ä—É–π –≤—Å–µ –≤—ã–≤–æ–¥—ã –∏–∑ —à–∞–≥–æ–≤ 3, 4 –∏ 5.
    *   –û–±–æ—Å–Ω—É–π, –ø–æ—á–µ–º—É –∫–∞–Ω–¥–∏–¥–∞—Ç –ø–æ–¥—Ö–æ–¥–∏—Ç –∏–ª–∏ –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –ø–æ –∫–∞–∂–¥–æ–º—É –∏–∑ –∫–ª—é—á–µ–≤—ã—Ö –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤ –≤–∞–∫–∞–Ω—Å–∏–∏.
    *   –ü–æ–¥—á–µ—Ä–∫–Ω–∏ —Å–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã –∫–∞–Ω–¥–∏–¥–∞—Ç–∞ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –≤–∞–∫–∞–Ω—Å–∏–∏ –∏ –≤—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–µ–ª—ã –∏–ª–∏ —Ä–∏—Å–∫–∏.
    *   –û—Å–æ–±–æ–µ –≤–Ω–∏–º–∞–Ω–∏–µ —É–¥–µ–ª–∏ –≤–ª–∏—è–Ω–∏—é –∫–∞—á–µ—Å—Ç–≤–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Ä–µ–∑—é–º–µ –Ω–∞ –æ–±—â–∏–π –≤—ã–≤–æ–¥.

**–§–æ—Ä–º–∞—Ç –í—ã–≤–æ–¥–∞:**

1.  **–ö–æ—Ä–æ—Ç–∫–∏–π –ê–Ω–∞–ª–∏–∑ (200-300 —Å–ª–æ–≤):**
    *   –ù–∞—á–Ω–∏ —Å –æ–±—â–µ–≥–æ —Ä–µ–∑—é–º–µ, –∑–∞—Ç–µ–º –¥–µ—Ç–∞–ª–∏–∑–∏—Ä—É–π –æ—Å–Ω–æ–≤–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã: —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∫–ª—é—á–µ–≤—ã–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º, –∫–∞—á–µ—Å—Ç–≤–æ –æ–ø—ã—Ç–∞, –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª.
    *   **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û** –≤–∫–ª—é—á–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–π –∞–±–∑–∞—Ü, –ø–æ—Å–≤—è—â–µ–Ω–Ω—ã–π –∫–∞—á–µ—Å—Ç–≤—É –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Ä–µ–∑—é–º–µ (–ø–æ–Ω—è—Ç–Ω–æ—Å—Ç—å –∑–∞–¥–∞—á –∏ —Å–ø–æ—Å–æ–±–æ–≤ –∏—Ö —Ä–µ—à–µ–Ω–∏—è, –∫–æ–Ω–∫—Ä–µ—Ç–∏–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π). –û–±—ä—è—Å–Ω–∏, –∫–∞–∫ —ç—Ç–æ –ø–æ–≤–ª–∏—è–ª–æ –Ω–∞ –æ–±—â—É—é –æ—Ü–µ–Ω–∫—É.
    *   –ó–∞–≤–µ—Ä—à–∏ –∫—Ä–∞—Ç–∫–∏–º –≤—ã–≤–æ–¥–æ–º –æ –ø—Ä–∏—á–∏–Ω–∞—Ö –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–π –æ—Ü–µ–Ω–∫–∏.

2.  **–ò—Ç–æ–≥–æ–≤–∞—è –û—Ü–µ–Ω–∫–∞:**
    *   –ï–¥–∏–Ω–∞—è —á–∏—Å–ª–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞ –æ—Ç 1 –¥–æ 10. –≠—Ç–∞ –æ—Ü–µ–Ω–∫–∞ –¥–æ–ª–∂–Ω–∞ –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ –æ—Ç—Ä–∞–∂–∞—Ç—å –∫–∞–∫ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞ –≤–∞–∫–∞–Ω—Å–∏–∏, —Ç–∞–∫ –∏ –∫–∞—á–µ—Å—Ç–≤–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∏–º —Å–≤–æ–µ–≥–æ –æ–ø—ã—Ç–∞ –≤ —Ä–µ–∑—é–º–µ.
""".strip()

def request_gpt(system_prompt, user_prompt):
    response = client.chat.completions.create(
        model="gpt-4o-mini",
        messages=[
            {"role": "system", "content": system_prompt},  
            {"role": "user", "content": user_prompt},     
        ],
        max_tokens=1000,
        temperature=0,
    )
    return response.choices[0].message.content

# UI
st.title('CV Scoring App')

job_description = st.text_area('–í–≤–µ–¥–∏—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ –≤–∞–∫–∞–Ω—Å–∏—é')
cv = st.text_area('–í–≤–µ–¥–∏—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ —Ä–µ–∑—é–º–µ')

if st.button("–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ"):
    with st.spinner("–ü–∞—Ä—Å–∏–º –¥–∞–Ω–Ω—ã–µ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ GPT..."):
        try:
            job_html = get_html(job_description).text
            resume_html = get_html(cv).text

            job_text = extract_vacancy_data(job_html)
            resume_text = extract_resume_data(resume_html)

            prompt = f"# –í–ê–ö–ê–ù–°–ò–Ø\n{job_text}\n\n# –†–ï–ó–Æ–ú–ï\n{resume_text}"
            response = request_gpt(SYSTEM_PROMPT, prompt)

            st.subheader("üìä –†–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª–∏–∑–∞:")
            st.markdown(response)

        except Exception as e:
            st.error(f"–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞: {e}")
